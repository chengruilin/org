#+TITLE: Weex 源码分析
#+TODO: TODO(t) DOING(d!) PAUSE(p!) RESUME(r!) | DONE(e)

* TODO Weex Source Code [3/6]
  :PROPERTIES:
  :COOKIE_DATA: todo recursive
  :END:

** DOING Weex 使用相关
   - State "DOING"      from "TODO"       [2018-10-10 三 17:56]
*** Weex 扩展

**** DONE Module
     CLOSED: [2018-10-10 三 17:56]
     - State "DOING"      from "TODO"       [2018-10-10 三 17:42]

     Module 扩展非 UI 功能
     1. extends WXModule
     2. @JsMethod(uiThread = false or true)
     3. public function
     4. -keep public class * extends com.taobao.weex.common.WXModule{*;}
     5. 方法参数:int,double,float,String,Map,List
     6. Register: WXSDKEngine.registerModule("myModule", MyModule.class);

     Weex Module Sample:
     #+BEGIN_SRC java
       public class MyModule extends WXModule {

           //run ui thread
           @JSMethod (uiThread = true)
           public void printLog(String msg) {
               Toast.makeText(mWXSDKInstance.getContext(),msg,Toast.LENGTH_SHORT).show();
           }

           //run JS thread
           @JSMethod (uiThread = false)
           public void fireEventSyncCall(){
               //implement your module logic here
           }
       }
     #+END_SRC

     Register code:
     #+BEGIN_SRC java
       WXSDKEngine.registerModule("MyModule", MyModule.class);
     #+END_SRC

     Js call:
     #+BEGIN_SRC html
       <template>
         <div>
           <text onclick="click">testMyModule</text>
         </div>
       </template>

       <script>
         module.exports = {
           methods: {
             click: function() {
               weex.requireModule('MyModule').printLog("I am a weex Module");
             }
           }
         }
       </script>
     #+END_SRC

**** DONE Component
     CLOSED: [2018-10-10 三 17:56]
     - State "DOING"      from "TODO"       [2018-10-10 三 17:42]

     Component 扩展实现 Native 控件
     1. extends WXComponent
     2. @WXComponentProp(name=value(value is attr or style of dsl))
     3. -keep public class * extends com.taobao.weex.common.WXComponent{*;}
     4. 方法参数:int,double,float,String,Map,List
     5. WXSDKEngine.registerComponent("richText", RichText.class);

     Weex Component Sample:
     #+BEGIN_SRC java
       public class RichText extends WXComponent<TextView> {

           public RichText(WXSDKInstance instance, WXDomObject dom, WXVContainer parent) {
               super(instance, dom, parent);
           }

           @Override
           protected TextView initComponentHostView(@NonNull Context context) {
               TextView textView = new TextView(context);
               textView.setTextSize(20);
               textView.setTextColor(Color.BLACK);
               return textView;
           }

           @WXComponentProp(name = "tel")
           public void setTel(String telNumber) {
               getHostView().setText("tel: " + telNumber);
           }
       }
     #+END_SRC

     Register code:
     #+BEGIN_SRC java
       WXSDKEngine.registerComponent("richText", RichText.class);
     #+END_SRC

     Js call:
     #+BEGIN_SRC html
       <template>
         <div>
           <richText tel="12305" style="width:200;height:100">12305</richText>
         </div>
       </template>
     #+END_SRC

**** DONE Adapter
     CLOSED: [2018-10-10 三 17:56]
     - State "DOING"      from "DOING"      [2018-10-10 三 17:55]
     扩展图片加载:
     #+BEGIN_SRC java
       public class ImageAdapter implements IWXImgLoaderAdapter {

           public ImageAdapter() {
           }

           @Override
           public void setImage(final String url, final ImageView view,
                                WXImageQuality quality, WXImageStrategy strategy) {

               WXSDKManager.getInstance().postOnUiThread(new Runnable() {

                       @Override
                       public void run() {
                           if(view==null||view.getLayoutParams()==null){
                               return;
                           }
                           if (TextUtils.isEmpty(url)) {
                               view.setImageBitmap(null);
                               return;
                           }
                           String temp = url;
                           if (url.startsWith("//")) {
                               temp = "http:" + url;
                           }
                           if (view.getLayoutParams().width <= 0 || view.getLayoutParams().height <= 0) {
                               return;
                           }
                           Picasso.with(WXEnvironment.getApplication())
                               .load(temp)
                               .into(view);
                       }
                   },0);
           }
       }
     #+END_SRC
     
*** TODO Lifecycle
**** Workflow
     Create Instance:
     [[./weex/imgs/img_weex_lifecycle_create_instance.jpeg]]
** TODO 源码分析
